<div class="container-fluid">
	<div class="row">
		<div class="span10">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th-list"></i> </span>
					<h5>Your Usage</h5>
				</div>
				<div class="widget-content" >
					<div class="row">
						<div class="span4">
							<div class="cb_box">
								<h4 align="center"> Quota</h4><h3 align="center" ><span class="icon"><i class="fa fa-book"></i></span>&nbsp;<%= @launched_books_quota %>&nbsp; of 2</h3> <% @percent = @launched_books_quota/2.0*100 %>
							</div>
							<% if @percent >= 80 %>
							</br>
							<div class="progress progress-warning">
								<div class="bar" style="width: <%= @percent %>%;"></div>
							</div>
							<% else %>
							<br/>
							<div class="progress progress-success">
								<div class="bar" style="width: <%= @percent %>%;"></div>
							</div>
							<% end %>
						</div>

						<div class="span4">
							<span class="btn btn-large disabled btn-block"><h3><%= @launched_books_quota %></h3> <h4>Launched </h4> </span>
							</br>
							<a href="http://support.megam.co/kb/cloud-applications/"><i class="fa fa-question"> We are here to help </i> </a>
						</div>
						<div class="span4">
							<div class="cb_box">
								<h4 align="center" >Recent Activity</h4><h5 align="Center"><span class="icon"> <i class="fa fa-calendar"></i> </span><b><%= latest_book.created_at.to_formatted_s(:rfc822) %></b></h5> <% @launched_books.select{|k, v|k==latest_book.name}.each do |k, v| %>
								<% v.each do |node| %>
								<% cloud_book = @nodes.lookup(node) %> <h5 align="Center"> <%= link_to "#{cloud_book.node_name}", cloud_book_path(:id => latest_book.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %> </h5> <% end %>
								<% end %>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="span4">
							<%= link_to new_cloud_book_path, class: "btn btn-large btn-success btn-block", :target => "_self" do %>
							Create
							<% end %>
						</div>
						<div class="span4">
							<%= link_to "Watch Run History", cloud_books_histories_path, class: "btn btn-large btn-info btn-block", :target => "_self" %>
						</div>
						<div class="span4">
							<%= link_to "Upgrade", pricing_path, class: "btn btn-large btn-inverse btn-block ", :target => "_self" %>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="span10">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon"> <i class="fa fa-th-list"></i> </span>
					<h5>Your Launched Books In Cloud {Nodes}</h5>
				</div>
				<div class="widget-content">
					<% @launched_books.each do |k, v| %>
					<% cb = CloudBook.find_by_name(k) %>
					<div class="accordion" id="collapse-group">
						<div class="accordion-group widget-box">
							<div class="accordion-heading">
								<div class="widget-title">
									<a data-parent="#collapse-group" href="#collapse<%= k%>" data-toggle="collapse"> <span class="icon"> <i class="fa fa-magnet"></i></span> <% if cb.book_type == 'APP' %> <span class="label label-info"> <%= cb.book_type %> </span> <% elsif cb.book_type == 'BOLT' %> <span class="label label-warning"><%= cb.book_type %></span> <% end %> </a>
									<p></p>
									<span class="badge badge-info"><%= k%></span>
								</div>
							</div>
							<div class="collapse accordion-body" id="collapse<%= k%>">
								<div class="widget-content nopadding"  style="overflow-y: scroll; height:250px;">
									<table class="table">
										<thead>
											<tr>
												<th>Actions</th>
												<th>Name</th>
												<th>Clone</th>
												<th>Destroy</th>
												<th>Created At</th>
												<th>Status</th>
											</tr>
										</thead>
										<tbody>
											<% v.each do |node| %>

											<tr>
												<% cloud_book = @nodes.lookup(node) %>
												<td> <% if cloud_book.node_type == "APP" %>
												<div class="btn-group">
													<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-folder-open"> Actions </span> <span class="caret"></span> </a>
													<ul class="dropdown-menu">
														<li>
															<%= link_to send_request_path(:scm => cloud_book.predefs[:scm],:node_name => cloud_book.node_name, :book_type => cloud_book.node_type, :defns_id => cloud_book.appdefnsid, :status => cloud_book.status, :req_type => "build"), :remote => true,  data: { spinlock: '#cloud_book_request_now_nbuild'} do %>
															<i class="fa fa-building-o">&nbsp;Build&nbsp;</i> <% end %>
															<%= mini_spinner_tag  'cloud_book_request_now_nbuild' %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to send_request_path(:scm => cloud_book.predefs[:scm],:node_name => cloud_book.node_name, :book_type => cloud_book.node_type, :defns_id => cloud_book.appdefnsid, :status => cloud_book.status, :req_type => "start"), :remote => true,  data: { spinlock: '#cloud_book_request_now_nstart'} do %>
															<i class="fa fa-play">&nbsp;Start&nbsp;</i> <% end %>
															<%= mini_spinner_tag  'cloud_book_request_now_nstart' %>
														</li>
														<li>
															<%= link_to send_request_path(:scm => cloud_book.predefs[:scm],:node_name => cloud_book.node_name, :book_type => cloud_book.node_type, :defns_id => cloud_book.appdefnsid, :status => cloud_book.status, :req_type => "stop"), :remote => true,  data: { spinlock: '#cloud_book_request_now_nstop'} do %>
															<i class="fa fa-stop">&nbsp;Stop&nbsp;</i> <% end %>
															<%= mini_spinner_tag  'cloud_book_request_now_nstop' %>
														</li>
														<li>
															<%= link_to send_request_path(:scm => cloud_book.predefs[:scm],:node_name => cloud_book.node_name, :book_type => cloud_book.node_type, :defns_id => cloud_book.appdefnsid, :status => cloud_book.status, :req_type => "restart"), :remote => true,  data: { spinlock: '#cloud_book_request_now_nrestart'} do %>
															<i class="fa fa-refresh">&nbsp;Restart&nbsp;</i> <% end %>
															<%= mini_spinner_tag  'cloud_book_request_now_nrestart' %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to "More", cloud_book_path(:action => "show", :id => cb.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %>
														</li>
														</li>
													</ul>
												</div> <% else %>
												<div class="btn-group">
													<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"> Actions <span class="caret"></span> </a>
													<ul class="dropdown-menu">
														<li>
															<%= link_to "Start Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "start"), :remote => true %>
														</li>
														<li>
															<%= link_to "Stop Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "stop"), :remote => true %>
														</li>
														<li>
															<%= link_to "Restart Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "restart"), :remote => true %>
														</li>
														<li class="divider"></li>
														<li>
															<%= link_to "Backup Bolt", build_request_path(:name => cloud_book.node_name, :defnsid => cloud_book.boltdefnsid, :req => "build"), :remote => true %>
														</li>
														<li>
															<%= link_to "More", cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :book_type => cloud_book.node_type), :remote => true, data: { spinlock: '#book'} %>
														</li>
													</ul>
												</div> <% end %> </td>
												<td> <%= link_to "#{cloud_book.node_name}", "http://#{cloud_book.node_name}" , { :target => '_blank'} %> </td>
												<td> <%= link_to clone_build_path(:name => cloud_book.node_name), :class =>"btn btn-mini btn-success", :title=> "Clone Cloud Book", :remote => true, method: :post do %> <i class="fa fa-copy"> Clone</i> <% end %> </td>
												<td> <%= link_to cloud_book_path(:id => cb.id, :name => cloud_book.node_name, :launched_books => @launched_books), :class =>"btn btn-mini btn-danger", :title=> "Delete Cloud Book", method: :delete, :remote => true, :target => "_self", :data => { :confirm => "Are you sure?", spinner: '#delete_node'} do %> <i class="fa fa-trash-o"> Delete</i> <% end %>  <%= mini_spinner_tag 'delete_node' %> </td>
												<td><span class="icon"> <i class="fa fa-calendar"></i> </span> <%= cloud_book.created_at.to_datetime.to_formatted_s(:rfc822) %> </td>
												<td> <%= cloud_book.status %> </td>
											</tr>

											<% end %>
										</tbody>

									</table>

								</div>
							</div>
						</div>
					</div>
					<% end %>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="span10" >
			<div  id="cb_action"></div>
		</div>

	</div>

</div>
<!-- container-fluid -->
<div id="cloud_book_request_now_popup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
			×
		</button>
		<h3 id="myModalLabel">Cloud Book</h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-success">

			<p>
				Your request was submitted to megam cloud gateway was successful.
				</br>
				<div id="cloud_book_request_now_success"></div>
				</br>
				&nbsp;<strong>Click<span class="label label-info">&nbsp; OK &nbsp;</span>&nbsp;&nbsp; to watch the status</strong>
			</p>
		</div>
	</div>
	<div class="modal-footer">
		<%= link_to  "Ok", cloud_books_path, :class => "btn btn-primary", :target => "_self"%>
	</div>
</div>

<div id="cloud_book_request_now_popup_error" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
			×
		</button>
		<h3 id="myModalLabel">Build</h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-error">
			<p>
				Your request to megam cloud gateway was not successful.
				</br>
				<div id="err_msg"></div>
			</p>
		</div>
	</div>
	<div class="modal-footer">
		<%= link_to  "Ok", cloud_books_path, :class => "btn btn-primary", :target => "_self"%>
	</div>
</div>
